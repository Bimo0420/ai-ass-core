# AI Local Agent (Supabase) ‚Äî –ê–Ω–∞–ª–∏–∑ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

## üìã –û–±—â–∞—è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–ù–∞–∑–≤–∞–Ω–∏–µ** | AI local agent (Supabase) |
| **ID Workflow** | RNYHVhxQDDwYZ2Vc |
| **–°—Ç–∞—Ç—É—Å** | Active |
| **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤** | 8 |
| **–í–µ—Ä—Å–∏—è API** | v1 |

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Workflow

### –í–∏–∑—É–∞–ª—å–Ω–∞—è –°—Ö–µ–º–∞ –ü–æ—Ç–æ–∫–∞ –î–∞–Ω–Ω—ã—Ö

```
                                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                    ‚îÇ   Ollama Chat Model  ‚îÇ
                                    ‚îÇ     (gpt-oss:20b)    ‚îÇ
                                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                               ‚îÇ ai_languageModel
                                               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   main   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   main   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   main   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Webhook ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ AI Agent ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ Clean Output ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ Respond to Webhook  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚ñ≤
                           ‚îÇ ai_memory
                     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                     ‚îÇ  Postgres ‚îÇ
                     ‚îÇChat Memory‚îÇ
                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚ñ≤
                           ‚îÇ ai_tool
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ  Supabase Vector Store  ‚îÇ
              ‚îÇ      (Native n8n)       ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ ai_embedding
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ   Embeddings Ollama     ‚îÇ
              ‚îÇ  (nomic-embed-text)     ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîß –î–µ—Ç–∞–ª—å–Ω–æ–µ –û–ø–∏—Å–∞–Ω–∏–µ –£–∑–ª–æ–≤

### 1. Webhook (–¢–æ—á–∫–∞ –í—Ö–æ–¥–∞)

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–¢–∏–ø** | n8n-nodes-base.webhook |
| **–í–µ—Ä—Å–∏—è** | 2.1 |
| **HTTP –ú–µ—Ç–æ–¥** | POST |
| **–ü—É—Ç—å** | `/835ac6af-d2ac-4208-9f5f-8e45cd161090` |
| **–†–µ–∂–∏–º –æ—Ç–≤–µ—Ç–∞** | lastNode |

**–§—É–Ω–∫—Ü–∏—è:**  
–ò–¥–µ–Ω—Ç–∏—á–µ–Ω LlamaIndex-–≤–∞—Ä–∏–∞–Ω—Ç—É. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç POST-–∑–∞–ø—Ä–æ—Å—ã –æ—Ç OpenWebUI.

---

### 2. AI Agent (–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –ê–≥–µ–Ω—Ç)

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–¢–∏–ø** | @n8n/n8n-nodes-langchain.agent |
| **–í–µ—Ä—Å–∏—è** | 2.2 |
| **Prompt Type** | define |
| **Batch Size** | 4 |
| **Delay Between Batches** | 100ms |

**–ü–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- üß† Language Model: Ollama Chat Model
- üíæ Memory: Postgres Chat Memory  
- üîß Tool: Supabase Vector Store (–≤–º–µ—Å—Ç–æ HTTP Tool)

---

### 3. Ollama Chat Model (–Ø–∑—ã–∫–æ–≤–∞—è –ú–æ–¥–µ–ª—å)

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–ú–æ–¥–µ–ª—å** | `gpt-oss:20b` |
| **Temperature** | 0.3 |
| **Use MLock** | true |

–ò–¥–µ–Ω—Ç–∏—á–µ–Ω LlamaIndex-–≤–∞—Ä–∏–∞–Ω—Ç—É.

---

### 4. Postgres Chat Memory (–ü–∞–º—è—Ç—å –ß–∞—Ç–∞)

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **Session Key** | `{{ $json.chatid }}` |
| **Context Window Length** | 1 |

–ò–¥–µ–Ω—Ç–∏—á–µ–Ω LlamaIndex-–≤–∞—Ä–∏–∞–Ω—Ç—É. **–¢–∞ –∂–µ –ø—Ä–æ–±–ª–µ–º–∞ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º.**

---

### 5. Supabase Vector Store (–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ü–æ–∏—Å–∫–∞) ‚≠ê

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–¢–∏–ø** | @n8n/n8n-nodes-langchain.vectorStoreSupabase |
| **–í–µ—Ä—Å–∏—è** | 1.3 |
| **–†–µ–∂–∏–º** | `retrieve-as-tool` |
| **–¢–∞–±–ª–∏—Ü–∞** | `data_llamaindex_vectors` |
| **Top K** | 8 |

**–û–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞:**
> "–ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –∑–Ω–∞–Ω–∏–π –ø–æ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –≤–æ–ø—Ä–æ—Å–∞–º"

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞—Ç–∏–≤–Ω—ã–π n8n-–∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Vector Store
- –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é —Å Supabase –±–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ API
- **–¢–æ–ª—å–∫–æ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫** (–±–µ–∑ BM25/hybrid)

---

### 6. Embeddings Ollama (–ú–æ–¥–µ–ª—å –≠–º–±–µ–¥–¥–∏–Ω–≥–æ–≤)

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–¢–∏–ø** | @n8n/n8n-nodes-langchain.embeddingsOllama |
| **–í–µ—Ä—Å–∏—è** | 1 |
| **–ú–æ–¥–µ–ª—å** | `nomic-embed-text:latest` |

**–§—É–Ω–∫—Ü–∏—è:**  
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –º–æ–¥–µ–ª–∏ nomic-embed-text:**
- –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å: 768
- –ö–æ–Ω—Ç–µ–∫—Å—Ç: –¥–æ 8192 —Ç–æ–∫–µ–Ω–æ–≤
- –•–æ—Ä–æ—à–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç–∏

---

### 7. Clean Output (–ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞)

–ò–¥–µ–Ω—Ç–∏—á–µ–Ω LlamaIndex-–≤–∞—Ä–∏–∞–Ω—Ç—É. –¢–æ—Ç –∂–µ JavaScript –∫–æ–¥ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏.

---

### 8. Respond to Webhook (–û—Ç–≤–µ—Ç)

–ò–¥–µ–Ω—Ç–∏—á–µ–Ω LlamaIndex-–≤–∞—Ä–∏–∞–Ω—Ç—É.

---

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å –†–∞–±–æ—Ç—ã (Flow)

```mermaid
sequenceDiagram
    participant OW as OpenWebUI
    participant WH as n8n Webhook
    participant AG as AI Agent
    participant OL as Ollama (gpt-oss:20b)
    participant PG as PostgreSQL Memory
    participant EMB as Ollama Embeddings
    participant SB as Supabase Vector Store
    participant CO as Clean Output

    OW->>WH: POST {currentMessage, systemPrompt, chatid}
    WH->>AG: –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞
    AG->>PG: –ó–∞–ø—Ä–æ—Å –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞ (chatid)
    PG-->>AG: –ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (contextWindow=1)
    
    AG->>OL: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ + –∫–æ–Ω—Ç–µ–∫—Å—Ç
    OL-->>AG: –†–µ—à–µ–Ω–∏–µ –æ –≤—ã–∑–æ–≤–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
    
    alt –ê–≥–µ–Ω—Ç —Ä–µ—à–∞–µ—Ç –≤—ã–∑–≤–∞—Ç—å Supabase Vector Store
        AG->>EMB: –¢–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∞
        EMB-->>AG: –í–µ–∫—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–∞ [768 dim]
        AG->>SB: Vector similarity search (top_k=8)
        SB-->>AG: 8 –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ—Ö–æ–∂–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
        AG->>OL: –ü—Ä–æ–º–ø—Ç + –¥–æ–∫—É–º–µ–Ω—Ç—ã + –≤–æ–ø—Ä–æ—Å
        OL-->>AG: –û—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
    else –û—Ç–≤–µ—Ç –±–µ–∑ –ø–æ–∏—Å–∫–∞
        OL-->>AG: –ü—Ä—è–º–æ–π –æ—Ç–≤–µ—Ç
    end
    
    AG->>CO: –°—ã—Ä–æ–π –æ—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏
    CO-->>WH: –û—á–∏—â–µ–Ω–Ω—ã–π —Ä—É—Å—Å–∫–∏–π —Ç–µ–∫—Å—Ç
    WH-->>OW: HTTP Response
```

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å LlamaIndex-–≤–∞—Ä–∏–∞–Ω—Ç–æ–º

| –ê—Å–ø–µ–∫—Ç | Supabase Workflow | LlamaIndex Workflow |
|--------|-------------------|---------------------|
| **–¢–∏–ø –ø–æ–∏—Å–∫–∞** | –¢–æ–ª—å–∫–æ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π | –ì–∏–±—Ä–∏–¥–Ω—ã–π (BM25 + Semantic) |
| **Reranking** | ‚ùå –ù–µ—Ç | ‚úÖ BGE-reranker |
| **–≠–º–±–µ–¥–¥–∏–Ω–≥–∏** | Ollama (nomic-embed-text) | LlamaIndex API (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π) |
| **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** | 8 (top_k) | 5 (–ø–æ—Å–ª–µ reranking) |
| **–í–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** | –ú–µ–Ω—å—à–µ (–Ω–µ—Ç LlamaIndex) | –¢—Ä–µ–±—É–µ—Ç LlamaIndex API |
| **–ì–∏–±–∫–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ | –í—ã—Å–æ–∫–∞—è (–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞) |
| **–¢–æ—á–Ω–æ—Å—Ç—å –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤** | üîª –ù–∏–∂–µ | üî∫ –í—ã—à–µ (BM25) |
| **–õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** | –ë—ã—Å—Ç—Ä–µ–µ (~200ms –º–µ–Ω—å—à–µ) | –ú–µ–¥–ª–µ–Ω–Ω–µ–µ (2 —ç—Ç–∞–ø–∞ –ø–æ–∏—Å–∫–∞) |

---

## üîç –ì–ª—É–±–æ–∫–∏–π –ê–Ω–∞–ª–∏–∑ –ü—Ä–æ–±–ª–µ–º

### 1. –¢–æ–ª—å–∫–æ –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ü–æ–∏—Å–∫

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ç–æ–ª—å–∫–æ vector similarity search, –∑–∞–ø—Ä–æ—Å—ã —Å —Ç–æ—á–Ω—ã–º–∏ —Ç–µ—Ä–º–∏–Ω–∞–º–∏ –∏–ª–∏ –∏–º–µ–Ω–∞–º–∏ –º–æ–≥—É—Ç –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã.

**–ü—Ä–∏–º–µ—Ä:**
- –ó–∞–ø—Ä–æ—Å: "–ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –æ—Ñ–∏—Å –∫–æ–º–ø–∞–Ω–∏–∏ ABC?"
- –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –º–æ–∂–µ—Ç –Ω–µ –Ω–∞–π—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç —Å —Ç–æ—á–Ω—ã–º —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º "ABC"
- BM25 (keyword) –ø–æ–∏—Å–∫ –Ω–∞—à—ë–ª –±—ã –Ω–∞–ø—Ä—è–º—É—é

### 2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Reranking

**–ü—Ä–æ–±–ª–µ–º–∞:**  
Top-8 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –±–µ–∑ –ø–µ—Ä–µ—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è. –°—Ä–µ–¥–∏ –Ω–∏—Ö –º–æ–≥—É—Ç –±—ã—Ç—å "—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ –±–ª–∏–∑–∫–∏–µ", –Ω–æ –Ω–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ.

**–í–ª–∏—è–Ω–∏–µ:**
- –ë–æ–ª—å—à–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (8 vs 5) ‚Üí –º–µ–¥–ª–µ–Ω–Ω–µ–µ LLM inference
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –±–æ–ª—å—à–µ "—à—É–º–∞" –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ

### 3. –ü—Ä—è–º–∞—è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¢–∞–±–ª–∏—Ü—ã

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–£–∑–µ–ª Supabase Vector Store —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ç–∞–±–ª–∏—Ü–µ–π `data_llamaindex_vectors`. –ï—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–∑–º–µ–Ω–∏—Ç—Å—è (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ metadata, –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã), –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è workflow.

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –û–∂–∏–¥–∞–µ–º–æ–µ –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|-------------------|
| Webhook ‚Üí AI Agent | ~10-50ms |
| Embedding Generation | ~50-150ms |
| Supabase Vector Search | ~100-300ms |
| LLM First Token | ~500-2000ms |
| Total Response Time | ~1.5-4s |

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –ø–æ latency:**  
~200-500ms –±—ã—Å—Ç—Ä–µ–µ LlamaIndex-–≤–∞—Ä–∏–∞–Ω—Ç–∞ –∑–∞ —Å—á—ë—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è HTTP-–≤—ã–∑–æ–≤–∞ –∫ –≤–Ω–µ—à–Ω–µ–º—É API.

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –£–ª—É—á—à–µ–Ω–∏—é

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (–í—ã—Å–æ–∫–∏–π –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

1. **–£–≤–µ–ª–∏—á–∏—Ç—å Context Window Length**
   ```
   –¢–µ–∫—É—â–µ–µ: 1
   –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ: 5-10
   ```

2. **–î–æ–±–∞–≤–∏—Ç—å MMR (Maximal Marginal Relevance)**
   ```
   –ï—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Supabase Vector Store,
   –≤–∫–ª—é—á–∏—Ç—å MMR –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   ```

### –°—Ä–µ–¥–Ω–∏–π –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç

3. **–£–º–µ–Ω—å—à–∏—Ç—å top_k –∏ —É–ª—É—á—à–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ**
   ```
   –¢–µ–∫—É—â–µ–µ: top_k=8
   –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ: top_k=5 —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º–∏ embeddings
   ```
   –ú–µ–Ω—å—à–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ = –±—ã—Å—Ç—Ä–µ–µ LLM + –º–µ–Ω—å—à–µ —à—É–º–∞

4. **–£–ª—É—á—à–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞**
   ```
   –¢–µ–∫—É—â–µ–µ: "–ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –∑–Ω–∞–Ω–∏–π 
             –ø–æ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –≤–æ–ø—Ä–æ—Å–∞–º"
   
   –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ: "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π.
   –ö–û–ì–î–ê –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
   - –í–æ–ø—Ä–æ—Å—ã –æ –ø—Ä–æ–¥—É–∫—Ç–∞—Ö, —É—Å–ª—É–≥–∞—Ö, –ø—Ä–æ—Ü–µ–¥—É—Ä–∞—Ö
   - –ó–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—â–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
   –ö–û–ì–î–ê –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
   - –û–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã (–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è, –ø–æ–≥–æ–¥–∞)
   - –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—á—ë—Ç—ã
   - –í–æ–ø—Ä–æ—Å—ã –æ —Ç–µ–±–µ –∫–∞–∫ –æ–± –ò–ò"
   ```

5. **–†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ LlamaIndex-–≤–∞—Ä–∏–∞–Ω—Ç**
   ```
   –ï—Å–ª–∏ –∫–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤ –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–Ω–µ–µ —Å–∫–æ—Ä–æ—Å—Ç–∏,
   —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å LlamaIndex —Å –≥–∏–±—Ä–∏–¥–Ω—ã–º –ø–æ–∏—Å–∫–æ–º
   ```

### –ù–∏–∑–∫–∏–π –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç

6. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞—á–µ—Å—Ç–≤–∞ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤**
   - –°—Ä–∞–≤–Ω–∏—Ç—å nomic-embed-text —Å multilingual-e5-large
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ benchmark'–µ —Å —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏

7. **–î–æ–±–∞–≤–∏—Ç—å Metadata Filtering**
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–µ

---

## üîó –í–Ω–µ—à–Ω–∏–µ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

| –°–µ—Ä–≤–∏—Å | –≠–Ω–¥–ø–æ–∏–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|----------|------------|
| **Ollama** | Configured via credentials | LLM + Embeddings |
| **PostgreSQL** | Configured via credentials | Chat history |
| **Supabase** | Configured via credentials | Vector storage |

---

## ‚öñÔ∏è –ö–æ–≥–¥–∞ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≠—Ç–æ—Ç Workflow

### ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–≥–¥–∞:
- –°–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞ –∫—Ä–∏—Ç–∏—á–Ω–∞
- –ó–∞–ø—Ä–æ—Å—ã –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ (–Ω–µ —Ç–æ—á–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã)
- –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω–∞ (–±–µ–∑ LlamaIndex API)
- –ù—É–∂–Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏

### ‚ùå –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–≥–¥–∞:
- –ó–∞–ø—Ä–æ—Å—ã —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–æ—á–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è/—Ç–µ—Ä–º–∏–Ω—ã
- –ö–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤ –≤–∞–∂–Ω–µ–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
- –î–æ–∫—É–º–µ–Ω—Ç—ã —Å–∏–ª—å–Ω–æ –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è –ø–æ —Å–µ–º–∞–Ω—Ç–∏–∫–µ

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω: 2026-01-13*  
*–í–µ—Ä—Å–∏—è –∞–Ω–∞–ª–∏–∑–∞: 1.0*
