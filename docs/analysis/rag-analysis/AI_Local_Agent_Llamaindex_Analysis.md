# AI Local Agent (LlamaIndex) ‚Äî –ê–Ω–∞–ª–∏–∑ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

## üìã –û–±—â–∞—è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–ù–∞–∑–≤–∞–Ω–∏–µ** | AI local agent (LlamaIndex) |
| **ID Workflow** | RNYHVhxQDDwYZ2Vc |
| **–°—Ç–∞—Ç—É—Å** | Active |
| **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤** | 7 |
| **–í–µ—Ä—Å–∏—è API** | v1 |

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Workflow

### –í–∏–∑—É–∞–ª—å–Ω–∞—è –°—Ö–µ–º–∞ –ü–æ—Ç–æ–∫–∞ –î–∞–Ω–Ω—ã—Ö

```
                                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                    ‚îÇ   Ollama Chat Model  ‚îÇ
                                    ‚îÇ     (gpt-oss:20b)    ‚îÇ
                                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                               ‚îÇ ai_languageModel
                                               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   main   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   main   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   main   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Webhook ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ AI Agent ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ Clean Output ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ Respond to Webhook  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚ñ≤
                           ‚îÇ ai_memory
                     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                     ‚îÇ  Postgres ‚îÇ
                     ‚îÇChat Memory‚îÇ
                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚ñ≤
                           ‚îÇ ai_tool
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ   Hybrid Search Tool    ‚îÇ
              ‚îÇ  (HTTP ‚Üí LlamaIndex)    ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîß –î–µ—Ç–∞–ª—å–Ω–æ–µ –û–ø–∏—Å–∞–Ω–∏–µ –£–∑–ª–æ–≤

### 1. Webhook (–¢–æ—á–∫–∞ –í—Ö–æ–¥–∞)

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–¢–∏–ø** | n8n-nodes-base.webhook |
| **–í–µ—Ä—Å–∏—è** | 2.1 |
| **HTTP –ú–µ—Ç–æ–¥** | POST |
| **–ü—É—Ç—å** | `/835ac6af-d2ac-4208-9f5f-8e45cd161090` |
| **–†–µ–∂–∏–º –æ—Ç–≤–µ—Ç–∞** | lastNode (–æ—Ç–≤–µ—Ç –æ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É–∑–ª–∞) |

**–§—É–Ω–∫—Ü–∏—è:**  
–ü—Ä–∏–Ω–∏–º–∞–µ—Ç POST-–∑–∞–ø—Ä–æ—Å—ã –æ—Ç OpenWebUI (AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç Clone). –û–∂–∏–¥–∞–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
```json
{
  "body": {
    "currentMessage": "–í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
    "systemPrompt": "–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç",
    "chatid": "–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —á–∞—Ç–∞"
  }
}
```

---

### 2. AI Agent (–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –ê–≥–µ–Ω—Ç)

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–¢–∏–ø** | @n8n/n8n-nodes-langchain.agent |
| **–í–µ—Ä—Å–∏—è** | 2.2 |
| **Prompt Type** | define |
| **Batch Size** | 4 |
| **Delay Between Batches** | 100ms |

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- **–¢–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞:** `={{ $json.body.currentMessage }}` ‚Äî –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–°–∏—Å—Ç–µ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:** `={{ $json.body.systemPrompt }}` ‚Äî —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –∏–∑ OpenWebUI

**–ü–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- üß† Language Model: Ollama Chat Model
- üíæ Memory: Postgres Chat Memory  
- üîß Tool: Hybrid Search Tool

---

### 3. Ollama Chat Model (–Ø–∑—ã–∫–æ–≤–∞—è –ú–æ–¥–µ–ª—å)

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–¢–∏–ø** | @n8n/n8n-nodes-langchain.lmChatOllama |
| **–í–µ—Ä—Å–∏—è** | 1 |
| **–ú–æ–¥–µ–ª—å** | `gpt-oss:20b` |
| **Temperature** | 0.3 |
| **Use MLock** | true |

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ù–∏–∑–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (0.3) –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–æ–ª–µ–µ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏ —Ç–æ—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
- MLock –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –≤—ã–≥—Ä—É–∑–∫—É –º–æ–¥–µ–ª–∏ –∏–∑ RAM, —É—Å–∫–æ—Ä—è—è inference

---

### 4. Postgres Chat Memory (–ü–∞–º—è—Ç—å –ß–∞—Ç–∞)

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–¢–∏–ø** | @n8n/n8n-nodes-langchain.memoryPostgresChat |
| **–í–µ—Ä—Å–∏—è** | 1.3 |
| **Session ID Type** | customKey |
| **Session Key** | `{{ $json.chatid }}` |
| **Context Window Length** | 1 |

**‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –º–æ–º–µ–Ω—Ç:**  
`contextWindowLength: 1` –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è **—Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ**. –≠—Ç–æ —Å–∏–ª—å–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∞–≥–µ–Ω—Ç–∞ –≤–µ—Å—Ç–∏ —Å–≤—è–∑–Ω—ã–π –¥–∏–∞–ª–æ–≥.

---

### 5. Hybrid Search Tool (–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ì–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ü–æ–∏—Å–∫–∞) ‚≠ê

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–¢–∏–ø** | @n8n/n8n-nodes-langchain.toolHttpRequest |
| **–í–µ—Ä—Å–∏—è** | 1.1 |
| **URL** | `http://llamaindex:8000/hybrid-query` |
| **–ú–µ—Ç–æ–¥** | POST |

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "query": "{query}",
  "match_count": 40,
  "top_k": 5,
  "full_text_weight": 3.0,
  "semantic_weight": 1.0,
  "use_reranking": true
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞:**
| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|----------|
| `match_count` | 40 | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –≤—ã–±–æ—Ä–∫–∏ |
| `top_k` | 5 | –§–∏–Ω–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ—Å–ª–µ reranking |
| `full_text_weight` | 3.0 | –í–µ—Å –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ (BM25) –ø–æ–∏—Å–∫–∞ |
| `semantic_weight` | 1.0 | –í–µ—Å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ (vector) –ø–æ–∏—Å–∫–∞ |
| `use_reranking` | true | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å BGE-reranker |

**–û–ø–∏—Å–∞–Ω–∏–µ placeholder:**
> "–ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π"

---

### 6. Clean Output (–ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞)

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–¢–∏–ø** | n8n-nodes-base.code |
| **–í–µ—Ä—Å–∏—è** | 2 |
| **–Ø–∑—ã–∫** | JavaScript |

**–ê–ª–≥–æ—Ä–∏—Ç–º –æ—á–∏—Å—Ç–∫–∏:**

1. **–ü–æ–∏—Å–∫ —è–≤–Ω—ã—Ö –º–∞—Ä–∫–µ—Ä–æ–≤ –æ—Ç–≤–µ—Ç–∞:**
   - `–û—Ç–≤–µ—Ç:`, `–ò—Ç–∞–∫,`, `–†–µ–∑—É–ª—å—Ç–∞—Ç:`
   - `So answer:`, `Provide answer:`, `Let's craft answer:`

2. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞—á–∞–ª–∞ —Ä—É—Å—Å–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞:**
   - –ê–Ω–∞–ª–∏–∑ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è –∫–∏—Ä–∏–ª–ª–∏—Ü—ã –∏ –ª–∞—Ç–∏–Ω–∏—Ü—ã –≤ —Å—Ç—Ä–æ–∫–∞—Ö
   - –ù–∞—á–∞–ª–æ –æ—Ç–≤–µ—Ç–∞ = –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ —Å –ø—Ä–µ–æ–±–ª–∞–¥–∞–Ω–∏–µ–º –∫–∏—Ä–∏–ª–ª–∏—Ü—ã

3. **–£–¥–∞–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–æ—á–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤:**
   - `[source...]`, `(citation...)`
   - `Use bullet list`, `Cite sources`

4. **–û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
   - –£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–∏—Ö –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ —Å—Ç—Ä–æ–∫
   - Trimming –ø—Ä–æ–±–µ–ª–æ–≤

5. **Fallback:**
   - –ï—Å–ª–∏ –Ω–µ—Ç —Ä—É—Å—Å–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞: `"–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π."`

---

### 7. Respond to Webhook (–û—Ç–≤–µ—Ç)

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–¢–∏–ø** | n8n-nodes-base.respondToWebhook |
| **–í–µ—Ä—Å–∏—è** | 1.1 |
| **–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞** | text |
| **Content-Type** | application/json |

---

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å –†–∞–±–æ—Ç—ã (Flow)

```mermaid
sequenceDiagram
    participant OW as OpenWebUI
    participant WH as n8n Webhook
    participant AG as AI Agent
    participant OL as Ollama (gpt-oss:20b)
    participant PG as PostgreSQL Memory
    participant LI as LlamaIndex API
    participant CO as Clean Output

    OW->>WH: POST {currentMessage, systemPrompt, chatid}
    WH->>AG: –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞
    AG->>PG: –ó–∞–ø—Ä–æ—Å –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞ (chatid)
    PG-->>AG: –ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (contextWindow=1)
    
    AG->>OL: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ + –∫–æ–Ω—Ç–µ–∫—Å—Ç
    OL-->>AG: –†–µ—à–µ–Ω–∏–µ –æ –≤—ã–∑–æ–≤–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
    
    alt –ê–≥–µ–Ω—Ç —Ä–µ—à–∞–µ—Ç –≤—ã–∑–≤–∞—Ç—å Hybrid Search
        AG->>LI: POST /hybrid-query {query, params}
        LI-->>AG: –†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã (top_k=5)
        AG->>OL: –ü—Ä–æ–º–ø—Ç + –¥–æ–∫—É–º–µ–Ω—Ç—ã + –≤–æ–ø—Ä–æ—Å
        OL-->>AG: –û—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
    else –û—Ç–≤–µ—Ç –±–µ–∑ –ø–æ–∏—Å–∫–∞
        OL-->>AG: –ü—Ä—è–º–æ–π –æ—Ç–≤–µ—Ç
    end
    
    AG->>CO: –°—ã—Ä–æ–π –æ—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏
    CO-->>WH: –û—á–∏—â–µ–Ω–Ω—ã–π —Ä—É—Å—Å–∫–∏–π —Ç–µ–∫—Å—Ç
    WH-->>OW: HTTP Response
```

---

## üìä –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

| –ê—Å–ø–µ–∫—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| **–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫** | –ö–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç BM25 (full-text) –∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ –≤–µ—Å–∞–º–∏ |
| **Reranking** | BGE-reranker –ø–æ–≤—ã—à–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ |
| **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π API** | LlamaIndex –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –µ–¥–∏–Ω—É—é —Ç–æ—á–∫—É –¥–ª—è –ø–æ–∏—Å–∫–∞ |
| **–ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞** | –û—á–∏—Å—Ç–∫–∞ Chain-of-Thought reasoning –æ—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ |

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ü—Ä–æ–±–ª–µ–º—ã

| –ü—Ä–æ–±–ª–µ–º–∞ | –í–ª–∏—è–Ω–∏–µ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|---------|
| `contextWindowLength: 1` | –ê–≥–µ–Ω—Ç "–∑–∞–±—ã–≤–∞–µ—Ç" –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞ | –£–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 5-10 |
| –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–µ—Å–∞ –ø–æ–∏—Å–∫–∞ | –ù–µ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ —Ç–∏–ø –∑–∞–ø—Ä–æ—Å–∞ | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ |
| –û–¥–∏–Ω–∞–∫–æ–≤—ã–π top_k –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ | –ü—Ä–æ—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ–ª—É—á–∞—é—Ç –∏–∑–±—ã—Ç–æ—á–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç | –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π top_k |
| –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ fallback –ø—Ä–∏ –æ—à–∏–±–∫–µ LlamaIndex | Workflow –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞ | –î–æ–±–∞–≤–∏—Ç—å error handling |

---

## üîó –í–Ω–µ—à–Ω–∏–µ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

| –°–µ—Ä–≤–∏—Å | –≠–Ω–¥–ø–æ–∏–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|----------|------------|
| **Ollama** | Configured via credentials | LLM inference |
| **PostgreSQL** | Configured via credentials | Chat history storage |
| **LlamaIndex API** | `http://llamaindex:8000/hybrid-query` | RAG, Hybrid Search, Reranking |

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:**

1. **Latency components:**
   - Webhook ‚Üí AI Agent: ~10-50ms
   - AI Agent ‚Üí Ollama (first token): ~500-2000ms
   - Hybrid Search API call: ~200-1000ms
   - Total response time: ~2-5s

2. **Quality metrics:**
   - % –≤—ã–∑–æ–≤–æ–≤ Hybrid Search Tool
   - % –æ—Ç–≤–µ—Ç–æ–≤ "–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
   - –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –£–ª—É—á—à–µ–Ω–∏—é

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (–í—ã—Å–æ–∫–∏–π –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

1. **–£–≤–µ–ª–∏—á–∏—Ç—å Context Window Length**
   ```
   –¢–µ–∫—É—â–µ–µ: 1
   –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ: 5-10
   ```
   –ü–æ–∑–≤–æ–ª–∏—Ç –∞–≥–µ–Ω—Ç—É –ª—É—á—à–µ –ø–æ–Ω–∏–º–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞.

2. **–î–æ–±–∞–≤–∏—Ç—å Error Handling –¥–ª—è LlamaIndex**
   ```
   –î–æ–±–∞–≤–∏—Ç—å IF-—É–∑–µ–ª –ø–æ—Å–ª–µ Hybrid Search Tool
   –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏/—Å–µ—Ä–≤–∏—Å–∞
   ```

### –°—Ä–µ–¥–Ω–∏–π –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç

3. **–£–ª—É—á—à–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞**
   ```
   –¢–µ–∫—É—â–µ–µ: "–ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π"
   –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ: "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π 
   –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π. –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ 
   [–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–µ–º—ã]. –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π –¥–ª—è –æ–±—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤."
   ```

4. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π top_k –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–∞ –∑–∞–ø—Ä–æ—Å–∞**
   - –ü—Ä–æ—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã: top_k=3
   - –°–ª–æ–∂–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã: top_k=7-10

### –ù–∏–∑–∫–∏–π –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç

5. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**
6. **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–∏—Å–∫–∞**

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω: 2026-01-13*  
*–í–µ—Ä—Å–∏—è –∞–Ω–∞–ª–∏–∑–∞: 1.0*
